%!TEX root = thesis_proposal.tex

\chapter{Methodology}
\label{chap:m}

This section will first present the overall goals of the proposed dissertation project. Then, it will describe the methodology utilised by NDW to produce the prototype implementation and the one used by RHDHV to produce the commercial one. It will then present a detailed overview of my proposed research methodology.

NDW themselves produced a non-commercial prototype implementation that can achieve a 3D enrichment of NWB with only a few gaps in the produced elevation profiles. Although their workflow does not have a formal documentation, I have been given a verbal description of it, as well as the full output. Based on my understanding of these, their primary technique involved snapping close-by AHN3 Lidar points to the line geometries of NWB. Notable problems with the implementation included non-road points being snapped to centrelines, causing road centrelines to be extruded to overestimated elevations, in turn resulting in sudden jumps in the elevation profiles. Furthermore, no close-by points could be found for underground roads (i.e. tunnels), and strongly occluded parts of roads. For small gaps, this was resolved partially by writing an algorithm to interpolate linearly in such places, using the closest vertices where snapping was successful. For larger gaps, an attempt was made to resolve issues by including information from external sources semi-automatically. Neither issue could be fully resolved via these approaches, hence the results of this project were only used by NDW to gain a better understanding of the problem and the expected difficulties. For a reliable, commercial implementation they subsequently commissioned an implementation from RHDHV.

RHDHV developed their implementation in parallel with the planning of the present scientific research. I have attended NDW-RHDHV status meetings, discussed the implementation directly with RHDHV, and was given access to the codebase of the project. Understanding their implementation is crucial for this research, as it aims to both assess the accuracy of the commercial implementation, as well as compare the accuracy of its own scientific methodology (and implementation) to it. First, where NWB vertices are too sparse, densification takes place and additional temporary vertices are created inside NWB line segments. Then, different workflows are performed for R-roads and P-roads. For P-roads (for which DTB data does not generally exist), the workflow is similar in complexity to the one in the prototype, with the notable difference of using AHN3 DTM rasters. Although AHN3 DTM rasters are badly affected by both large holes and small groups of missing pixels (due to the fixed-parameter IDW interpolation that was used to generate them), RHDHV could make use of them by filling in the gaps of the raster using linear interpolation in a TIN created from the raster pixel centres and their elevations. They overlaid the raster tiles with NWB vertices (including the dense, temporary vertices) and interpolated their elevations using bilinear interpolation in the raster. For R-roads DTB is available, and the assumption is made by RHDHV that it is more accurate than AHN (or at least the stock DTM tiles generated from AHN), to the extent where it should be the primary source of elevation data. Priority is thus given to it in the procedure, with AHN-based interpolation used only as a fallback mechanism in case DTB-based height estimation fails. The goal of the procedure is to find the DTB line segments that delineate the road edges at any given location in the NWB and deduce elevations from them to extrude NWB. First, 2D cross-sections are constructed on NWB vertices, with each given the mean azimuth of the two NWB line segments that they are part of, and also on densified vertices, which receive azimuth values based simply on the azimuth of their parent line segments. DTB lines are then intersected with the cross-sections and for each cross-section, the closest DTB line that satisfies a relative angle condition is chosen, on both sides of NWB. Elevation is then first linearly interpolated inside the two chosen DTB segments to yield values exactly at their intersections with the cross-section. Then, elevation is interpolated linearly along the cross-section itself to yield the final elevation of the NWB vertex or densified temporary vertex. The angle condition is a threshold-based evaluation concerning the angle between intersected DTB lines and cross-sections and is intended to ensure that the chosen DTB segment indeed represents the edge of the road rather than that of another road. The assumption is made, therefore, that the DTB line segments representing road edges will be close to NWB centrelines and roughly parallel with them. Implicitly, this also assumes that NWB centrelines will lie between DTB road edges. In practice, none of these assumptions holds in general, hence a few failsafe mechanisms needed to also be implemented. Wherever the algorithm only finds a suitable DTB intersection on one side of NWB, it is only that side from which the elevation value is deduced. If no suitable intersection can be found whatsoever, the AHN3 raster-based interpolation is used instead. At NWB centreline end vertices (where no intersection exists, i.e. dead ends), the previous vertex’s elevation is simply repeated. It is worth mentioning that the RHDHV implementation deals with all non-standard input data sets (i.e. small-scale engineering models, road management datasets, etc.) by first converting them to identical rasters with the same specifications as AHN3 DTM tiles, and mosaicking them into an output raster based on a priority list, before filling in any remaining gaps.

There are various sources of issues  that I suspect to detect in our scientific analysis of the commercial implementation. For instance, point cloud to raster conversion is, by definition, associated with inherent information loss (less raster cells than pixels), and further reduction in accuracy is introduced by the interpolation mechanism itself. Radial IDW was used to generate AHN3 DTM tiles, which several of the reviewed papers found to be specifically unsuitable for interpolating large-scale areas in which zones of decreased point density (or gaps) exist (both of which characterise ground-filtered AHN data). In addition, the procedure performs another layer of interpolation to infill gaps, which may further affect accuracy negatively. It is also worth mentioning that RHDHV uses bilinear interpolation inside the raster to produce NWB elevations, which is suggested by e.g. Shi et al. 2005, to be less accurate than other common methods such as bicubic. In terms of their strong prioritising of DTB for R-roads, I should remark that DTB is also a secondary source of information (it is based on procedurally combining various types of sensing into vector features), and in contrast with AHN3, neither its overall nor its local accuracy are reported in its documentation or known from elsewhere. While it no doubt contains valuable information that may benefit the procedure, relying on it as the sole source of information may not be an approach that can guarantee the levels of accuracy needed for SWUNG2 compliance.

My approach is the result of a combined understanding of relevant concepts in related work, my own knowledge and experience relating to geomatics concepts and methods, as well as inspiration from the commercial implementation of RHDHV. The proposed workflow was built with the research questions in mind. The below summary is only a top-level description, as I expect the detailed specifications to change.

\begin{enumerate}
    \item Pre-processing
    \begin{enumerate}
        \item Keep only AHN3 points within a set distance from NWB lines. Consider classes 2 and 26 only.
        \item Keep only NWB R-roads and P-roads. Identify non-branching road segments, henceforth referred to as NBRSs. To identify them, first look for interconnected networks of MultiLineString objects sharing the same street name, then split off branches at intersections, always doing so in the order of decreasing angle (to ensure that a straight continuation of roads is natively preferred by the operation). Perform vertex densification for NBRS edges longer than a set distance.
        \item Keep only DTB “verflijnen”.
    \end{enumerate}
    \item Point cloud partitioning
    \begin{enumerate}
        \item For each NBRS from the previous stage, fit planes  to the neighbourhood of edges  and fetch  points that are close to them. When selecting a final plane from candidate planes, perform a similarity check between the parameters of neighbouring planes, so that the resulting succession of planes are not oriented unrealistically with respect to each other. Determine the exact procedure and parametrisation in a way that it is not too complex computationally, but still captures most Lidar points relevant to the given NBRS (i.e. do not use conservative thresholds at this stage).
        \item Merge the sub-clouds of edges into a single sub-cloud for the NBRS and save to disk with an identifier linking it to the NBRS itself.
    \end{enumerate}
    \item Road edge identification (to be performed on each NBRS)
        \item Construct cross-sections on NBRS vertices (including densified vertices) and snap close-by AHN3 points to them at a pre-set sampling distance along them.
        \begin{enumerate}
            \item Find the dominant line parametrisations of their elevation profiles and discard non-conformant points.
            \item Disregard points separated by gaps (created by the previous step) from the main group of points representing the fitted line (close to NWB), and points outside a maximum allowed road width. The outermost points in the detected series represent the approximate local position of the road edge.
            \item Disregard cross-sections where steps i. or ii. indicate that locally, NWB does not lie on the road surface as suggested AHN3 (for instance, because the best elevation regression line does not cross the NWB centreline in 2D).
            \item Derive mean elevations for each cross-section from the remaining points.
        \end{enumerate}
        \item The series of mean elevations (one per cross-section) is itself a 1D elevation profile. Perform outlier detection by sliding a kernel along this profile. Discard cross-sections where this operation indicated that the fitted line is significantly above the road surface. This will help eliminate cross sections corrupted by local groupings of non-road points (such as class-26 bridge structures).
        \item The remaining cross-sections are now each associated with a series of snapped Lidar points that form an approximate linear elevation trend along them. Assemble approximate global road edges from the two outermost Lidar points (on each side of NWB) of each cross-section.
        \item Use the left and right road edge estimates from the previous step as initial approximations in an active contour optimisation step. The constraints (energy terms): realistic horizontal distance from NWB for Dutch roads, and/or realistic distance from its own initial edge estimate, and a term “detecting” the first noticeable local change in curvature away from NWB.
        \item Select the Lidar points which lie between the optimised road contours in 2D. Thin the selected points to ensure that only the minimum point density needed to guarantee necessary accuracy remain.
        \item Insert the optimised contours into a CDT as constraints, and then the remaining Lidar points. Before inserting each point, interpolate in its location in the pre-existing CDT to test if it may be an outlier. Conservative thresholds are appropriate at this stage, as road surfaces are expected to be flat locally. Do not allow point insertion outside of the constraint-defined boundaries of the road.
        \item Interpolate NWB in the CDT using either linear, Laplace or natural neighbour interpolation (or some specialised variation thereof that uses a larger query zone and not just a single cell of the tessellation).
    \item NBRS merger
        \begin{enumerate}
            \item Re-assemble NWB from the NBRSs.
            \item Application of corrections at NWB intersections, smoothing. Yet undetermined if this will be necessary, as it depends on the final implementation. The topic is discussed below in more depth.
        \end{enumerate}
    \item DTB-based filling of large data gaps (after accuracy assessment – see below)
\end{enumerate}

Avoiding the creation of sudden jumps where NBRSs are stitched together may require special attention. In view of the above workflow, we may observe that in areas surrounding intersections, the CDT of each NBRS terminating there (or crossing it) will be constructed from roughly the same set of Lidar points (the road points). This is supported by the fact that the CDT construction step is mostly independent of the preceding cross-section-based workflow and the active contour approximation in the sense, that it works directly from the Lidar data. However, the proposed segmentation workflow cannot guarantee an identical CDT at intersections because the edge-based selection procedure may not select the exact same Lidar points for each NBRS that terminates at or crosses the intersection. Furthermore, depending on the quality of the raw output elevation profiles, some form of constrained smoothing along the centrelines may also be needed generally, not just across intersections. One solution that, in theory, is applicable to both purposes, is spline fitting. Using NWB vertices as control points could ensure not only continuity across intersections, but formal C1 smoothness across them and C2 everywhere else. However, this raises the question of how we should then treat the rule that the lateral position of NWB centrelines should not change, i.e. in theory the spline fitting would only have one degree of freedom.

The above workflow uses concepts already discussed in the last few paragraphs in the Related work section, particularly in Boyko and Funkhauser 2011. However, the cross-section based workflow and the use of a CDT to represent the final surface comes from other papers, such as Yang et al. 2013, Oude Elberink and Vosselman 2006. Furthermore, it is worth pointing out that while Boyko and Funkhauser 2011 specifically tuned their active contour optimisation to snap contours to curbs, my road-edge energy term will not be specialised to traditional curb geometries. It will simply be a term that attracts the contour to the first noticeable change in curvature away from NWB.

For the accuracy assessment part of the project, the following secondary workflow is proposed:

